<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone App</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: #f0f0f0;
            color: #333;
        }

        .phone-container {
            background: #fff;
            border-radius: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            width: 360px;
            height: 720px;
            position: relative;
        }

        .phone-frame {
            height: 100%;
            overflow: hidden;
            position: relative;
            background: linear-gradient(180deg, #2575fc, #6a11cb);
        }

        .phone-content {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .call-interface {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            padding: 40px 20px;
            color: #fff;
        }

        .call-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }

        .contact-photo-container {
            margin-right: 20px;
        }

        .contact-photo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .contact-info {
            flex-grow: 1;
        }

        .contact-name {
            font-size: 28px;
            font-weight: 700;
            margin: 0 0 5px;
        }

        .calling-status {
            font-size: 18px;
            opacity: 0.8;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.8; }
            50% { opacity: 0.5; }
            100% { opacity: 0.8; }
        }

        .call-duration {
            font-size: 24px;
            text-align: center;
            margin-bottom: 40px;
        }

        .audio-player {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
        }

        .microphone-btn {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            font-size: 24px;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .microphone-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .microphone-btn i {
            font-size: 32px;
        }

        .microphone-btn.active {
            animation: mic-pulse 1.5s infinite;
        }

        @keyframes mic-pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7);
            }
            70% {
                box-shadow: 0 0 0 15px rgba(255, 255, 255, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 255, 255, 0);
            }
        }

        .reply-options {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .reply-button {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: none;
            border-radius: 25px;
            padding: 15px 25px;
            font-size: 16px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            max-width: 300px;
            text-align: left;
        }

        .reply-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .reply-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .reply-button:disabled:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: none;
        }

        .start-prompt {
            position: absolute;
            bottom: 140px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #fff;
            font-size: 18px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .start-prompt.visible {
            opacity: 1;
        }

        .start-prompt span {
            margin-top: 10px;
        }

        .arrow {
            width: 30px;
            height: 30px;
            border-left: 3px solid #fff;
            border-top: 3px solid #fff;
            transform: rotate(45deg);
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% {
                transform: rotate(45deg) translate(0, 0);
            }
            50% {
                transform: rotate(45deg) translate(0, -10px);
            }
        }
    </style>
</head>
<body>
    <div class="phone-container">
        <div class="phone-frame">
            <div class="phone-content">
                <div class="call-interface">
                    <div class="call-header">
                        <div class="contact-photo-container">
                            <img src="/img/character2.png" alt="John Doe" class="contact-photo">
                        </div>
                        <div class="contact-info">
                            <h2 id="contact-name" class="contact-name">John Doe</h2>
                            <div id="calling-status" class="calling-status">Incoming call</div>
                        </div>
                    </div>
                    <div id="call-duration" class="call-duration">00:00</div>
                    <div class="audio-player">
                        <button id="microphone-btn" class="microphone-btn">
                            <i class="fas fa-microphone"></i>
                        </button>
                    </div>
                    <div id="reply-options" class="reply-options"></div>
                    <div id="start-prompt" class="start-prompt">
                        <div class="arrow"></div>
                        <span>Tap mic to start</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <audio id="audio-element"></audio>

    <script>
        const audioElement = document.getElementById('audio-element');
        const microphoneBtn = document.getElementById('microphone-btn');
        const replyOptions = document.querySelector('.reply-options');
        const callingStatus = document.querySelector('.calling-status');
        const callDuration = document.querySelector('.call-duration');
        const startPrompt = document.getElementById('start-prompt');

        const conversation = [
            {
                s: '/audio/stalker1.m4a',
                p: ['Hi', 'Hey too', 'Thanks for calling']
            },
            {
                s: '/audio/stalker2.m4a',
                p: ['I could be better', 'I guess so', 'No…']
            },
            {
                s: '/audio/stalker3.m4a',
                p: ['Yeah, just keep the call', 'I\'m not sure', 'Can you sing for me?']
            },
            {
                s: {
                    1: '/audio/stalker4(1).m4a',
                    2: '/audio/stalker4(2).m4a',
                    3: '/audio/singing.mp3'
                },
                p: ['Yes, please']
            },
            {
                s: '/audio/singing.mp3',
                p: ['Wow… You have the voice of an angel. Thank you', 'Thanks for that', 'Are you sure you should be singing?']
            },
            {
                s: '/audio/stalker5.m4a',
                p: ['Since we know my day was terrible, how\'s yours?']
            },
            {
                s: '/audio/stalker6.m4a',
                p: [
                    'That\'s nice. Can you make me one americano? I don\'t think I\'ll sleep tonight anyway',
                    'I see. That\'s nice',
                    'That\'s nice. At least a regular day is better than a bad day'
                ]
            },
            {
                s: {
                    1: '/audio/stalker7(1).m4a',
                    2: '/audio/stalker7(2).m4a',
                    3: '/audio/stalker7(3).m4a'
                },
                p: ['Sorry for being so negative today. I think I better take a warm shower and sleep this off.']
            },
            {
                s: '/audio/stalker8.m4a',
                p: ['You\'re such a flirt… But really, thanks for the call. It helped cheer me up a little']
            },
            {
                s: '/audio/stalker9.m4a',
                p: ['See you tomorrow']
            }
        ];

        let currentStep = 0;
        let lastChoice = null;
        let callTimer;
        let callDurationSeconds = 0;

        function updateCallDuration() {
            callDurationSeconds++;
            const minutes = Math.floor(callDurationSeconds / 60);
            const seconds = callDurationSeconds % 60;
            callDuration.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function startCallTimer() {
            callTimer = setInterval(updateCallDuration, 1000);
        }

        function stopCallTimer() {
            clearInterval(callTimer);
        }

        function updateAudioSource(source) {
            audioElement.src = source;
            audioElement.load();
        }

        function displayOptions(options) {
            replyOptions.innerHTML = '';
            options.forEach((option, index) => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('reply-button');
                button.disabled = true;
                button.style.opacity = '0';
                button.style.transform = 'translateY(20px)';
                button.addEventListener('click', () => handleOptionClick(index));
                replyOptions.appendChild(button);
                setTimeout(() => {
                    button.style.opacity = '1';
                    button.style.transform = 'translateY(0)';
                }, index * 100);
            });
        }

        function handleOptionClick(index) {
            lastChoice = index + 1;
            currentStep++;
            if (currentStep < conversation.length) {
                const step = conversation[currentStep];
                callingStatus.textContent = 'John is speaking...';
                replyOptions.style.opacity = '0';
                replyOptions.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    if (typeof step.s === 'object') {
                        updateAudioSource(step.s[lastChoice] || step.s[1]);
                    } else {
                        updateAudioSource(step.s);
                    }
                    playAudio();
                    replyOptions.style.opacity = '1';
                    replyOptions.style.transform = 'translateY(0)';
                    displayOptions(step.p);
                }, 1000);
            } else {
                endConversation();
            }
        }

        function endConversation() {
            callingStatus.textContent = 'Call ended';
            replyOptions.innerHTML = '';
            audioElement.src = '';
            stopCallTimer();
            microphoneBtn.classList.remove('active');
        }

        function playAudio() {
            audioElement.play();
            if (callDurationSeconds === 0) {
                startCallTimer();
            }
            microphoneBtn.classList.add('active');
        }

        function enableOptions() {
            const buttons = replyOptions.querySelectorAll('.reply-button');
            buttons.forEach(button => {
                button.disabled = false;
            });
            microphoneBtn.classList.remove('active');
        }

        window.addEventListener('load', () => {
            startPrompt.classList.add('visible');
        });

        microphoneBtn.addEventListener('click', () => {
            if (currentStep === 0) {
                startConversation();
                startPrompt.classList.remove('visible');
            } else {
                audioElement.play();
            }
        });

        audioElement.addEventListener('ended', () => {
            callingStatus.textContent = 'Your turn to speak';
            enableOptions();
        });

        audioElement.addEventListener('play', () => {
            if (audioElement.src.includes('singing.mp3')) {
                const skipButton = document.createElement('button');
                skipButton.textContent = 'Skip';
                skipButton.classList.add('reply-button');
                skipButton.addEventListener('click', () => {
                    audioElement.currentTime = audioElement.duration - 1;
                });
                replyOptions.appendChild(skipButton);
            }
        });

        function startConversation() {
            updateAudioSource(conversation[0].s);
            displayOptions(conversation[0].p);
            callingStatus.textContent = 'John is calling...';
            setTimeout(() => {
                callingStatus.textContent = 'John is speaking...';
                playAudio();
            }, 2000);
        }
    </script>
</body>
</html>